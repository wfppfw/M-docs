import{_ as e,o as r,c as t,a as o}from"./app.f245760f.js";const v=JSON.parse('{"title":"Manage events with service workers","description":"","frontmatter":{},"headers":[{"level":2,"title":"# Register the service worker","slug":"register-the-service-worker","link":"#register-the-service-worker","children":[]},{"level":2,"title":"# Initialize the extension","slug":"initialize-the-extension","link":"#initialize-the-extension","children":[]},{"level":2,"title":"# Set up listeners","slug":"set-up-listeners","link":"#set-up-listeners","children":[]},{"level":2,"title":"# Filter events","slug":"filter-events","link":"#filter-events","children":[]},{"level":2,"title":"# React to listeners","slug":"react-to-listeners","link":"#react-to-listeners","children":[]},{"level":2,"title":"# Unload background scripts","slug":"unload-background-scripts","link":"#unload-background-scripts","children":[]}],"relativePath":"chromedocs/In depth_ core concepts/Manage events with service workers - Chrome Developers.md"}'),n={name:"chromedocs/In depth_ core concepts/Manage events with service workers - Chrome Developers.md"},s=o(`<ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#manifest" target="_blank" rel="noreferrer">Register the service worker</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#initialization" target="_blank" rel="noreferrer">Initialize the extension</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#listeners" target="_blank" rel="noreferrer">Set up listeners</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#filters" target="_blank" rel="noreferrer">Filter events</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#react" target="_blank" rel="noreferrer">React to listeners</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#unloading" target="_blank" rel="noreferrer">Unload background scripts</a></li></ul><h1 id="manage-events-with-service-workers" tabindex="-1">Manage events with service workers <a class="header-anchor" href="#manage-events-with-service-workers" aria-hidden="true">#</a></h1><p>Published on Monday, September 17, 2012 \u2022 Updated on Tuesday, May 1, 2018</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#manifest" target="_blank" rel="noreferrer">Register the service worker</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#initialization" target="_blank" rel="noreferrer">Initialize the extension</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#listeners" target="_blank" rel="noreferrer">Set up listeners</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#filters" target="_blank" rel="noreferrer">Filter events</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#react" target="_blank" rel="noreferrer">React to listeners</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#unloading" target="_blank" rel="noreferrer">Unload background scripts</a></li></ul><p>Extensions are event-based programs used to modify or enhance the Chrome browsing experience. Events are browser triggers, such as navigating to a new page, removing a bookmark, or closing a tab. Extensions monitor these events using scripts in their background <a href="https://developer.chrome.com/docs/extensions/mv3/migrating_to_service_workers/" target="_blank" rel="noreferrer">service worker</a>, which then react with specified instructions.</p><p>A background service worker is loaded when it is needed, and unloaded when it goes idle. Some examples include:</p><ul><li>The extension is first installed or updated to a new version.</li><li>The background page was listening for an event, and the event is dispatched.</li><li>A content script or other extension <a href="https://developer.chrome.com/docs/extensions/mv3/messaging/" target="_blank" rel="noreferrer">sends a message.</a></li><li>Another view in the extension, such as a popup, calls <a href="https://developer.chrome.com/docs/extensions/runtime#method-getBackgroundPage" target="_blank" rel="noreferrer"><code>runtime.getBackgroundPage</code></a>.</li></ul><p>Once it has been loaded, an extension&#39;s service worker generally keeps running as long as it is performing an action, such as calling a Chrome API or issuing a network request.</p><p>Opening a view doesn&#39;t cause the service worker to load, but only prevents it from closing once loaded.</p><p>Effective background scripts stay dormant until an event they are listening for fires, react with specified instructions, then unload.</p><h2 id="register-the-service-worker" tabindex="-1"><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#manifest" target="_blank" rel="noreferrer">#</a> Register the service worker <a class="header-anchor" href="#register-the-service-worker" aria-hidden="true">#</a></h2><p>Extensions register their service worker in the <a href="https://developer.chrome.com/docs/extensions/mv3/manifest/" target="_blank" rel="noreferrer">manifest</a> under the <code>&quot;background&quot;</code> field. This field uses the <code>&quot;service_worker&quot;</code> key, which specifies a single JavaScript file.</p><pre><code>{  &quot;name&quot;: &quot;Awesome Test Extension&quot;,  ...  &quot;background&quot;: {    &quot;service_worker&quot;: &quot;background.js&quot;  },  ...}
</code></pre><p>You can optionally specify an extra field of <code>&quot;type&quot;: &quot;module&quot;</code> to include the service worker as an ES Module, which allows you to <code>import</code> further code. See <a href="https://web.dev/es-modules-in-sw/" target="_blank" rel="noreferrer">ES modules in service workers</a> for more information. For example:</p><pre><code>  &quot;background&quot;: {    &quot;service_worker&quot;: &quot;background.js&quot;,    &quot;type&quot;: &quot;module&quot;  }
</code></pre><h2 id="initialize-the-extension" tabindex="-1"><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#initialization" target="_blank" rel="noreferrer">#</a> Initialize the extension <a class="header-anchor" href="#initialize-the-extension" aria-hidden="true">#</a></h2><p>Listen to the <a href="https://developer.chrome.com/docs/extensions/reference/runtime#event-onInstalled" target="_blank" rel="noreferrer"><code>runtime.onInstalled</code></a> event to initialize an extension on installation. Use this event to set a state or for one-time initialization, such as a <a href="https://developer.chrome.com/docs/extensions/reference/contextMenus/" target="_blank" rel="noreferrer">context menu</a>.</p><pre><code>chrome.runtime.onInstalled.addListener(() =&gt; {  chrome.contextMenus.create({    &quot;id&quot;: &quot;sampleContextMenu&quot;,    &quot;title&quot;: &quot;Sample Context Menu&quot;,    &quot;contexts&quot;: [&quot;selection&quot;]  });});
</code></pre><h2 id="set-up-listeners" tabindex="-1"><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#listeners" target="_blank" rel="noreferrer">#</a> Set up listeners <a class="header-anchor" href="#set-up-listeners" aria-hidden="true">#</a></h2><p>Structure background scripts around events the extension depends on. Defining functionally relevant events allows background scripts to lie dormant until those events are fired and prevents the extension from missing important triggers.</p><p>Listeners must be registered synchronously from the start of the page.</p><pre><code>chrome.runtime.onInstalled.addListener(() =&gt; {  chrome.contextMenus.create({    &quot;id&quot;: &quot;sampleContextMenu&quot;,    &quot;title&quot;: &quot;Sample Context Menu&quot;,    &quot;contexts&quot;: [&quot;selection&quot;],  });});// This will run when a bookmark is created.chrome.bookmarks.onCreated.addListener(() =&gt; {  // do something});
</code></pre><p>Do not register listeners asynchronously, as they will not be properly triggered.</p><pre><code>chrome.runtime.onInstalled.addListener(() =&gt; {  // ERROR! Events must be registered synchronously from the start of  // the page.  chrome.bookmarks.onCreated.addListener(() =&gt; {    // do something  });});
</code></pre><p>Extensions can remove listeners from their background scripts by calling <code>removeListener</code>. If all listeners for an event are removed, Chrome will no longer load the extension&#39;s background script for that event.</p><pre><code>chrome.runtime.onMessage.addListener((message, sender, reply) =&gt; {  chrome.runtime.onMessage.removeListener(event);});
</code></pre><h2 id="filter-events" tabindex="-1"><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#filters" target="_blank" rel="noreferrer">#</a> Filter events <a class="header-anchor" href="#filter-events" aria-hidden="true">#</a></h2><p>Use APIs that support <a href="https://developer.chrome.com/docs/extensions/reference/events#filtered" target="_blank" rel="noreferrer">event filters</a> to restrict listeners to the cases the extension cares about. If an extension is listening for the <a href="https://developer.chrome.com/docs/extensions/reference/extensions/tabs#event-onUpdated" target="_blank" rel="noreferrer"><code>tabs.onUpdated</code></a> event, try using the <a href="https://developer.chrome.com/docs/extensions/reference/webNavigation#event-onCompleted" target="_blank" rel="noreferrer"><code>webNavigation.onCompleted</code></a> event with filters instead, as the tabs API does not support filters.</p><pre><code>const filter = {  url: [    {      urlMatches: &#39;https://www.google.com/&#39;,    },  ],};chrome.webNavigation.onCompleted.addListener(() =&gt; {  console.info(&quot;The user has loaded my favorite website!&quot;);}, filter);
</code></pre><h2 id="react-to-listeners" tabindex="-1"><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#react" target="_blank" rel="noreferrer">#</a> React to listeners <a class="header-anchor" href="#react-to-listeners" aria-hidden="true">#</a></h2><p>Listeners exist to trigger functionality once an event has fired. To react to an event, structure the desired reaction inside of the listener event.</p><pre><code>chrome.runtime.onMessage.addListener((message, callback) =&gt; {  const tabId = getForegroundTabId();  if (message.data === &quot;setAlarm&quot;) {    chrome.alarms.create({delayInMinutes: 5})  } else if (message.data === &quot;runLogic&quot;) {    chrome.scripting.executeScript({file: &#39;logic.js&#39;, tabId});  } else if (message.data === &quot;changeColor&quot;) {    chrome.scripting.executeScript(        {func: () =&gt; document.body.style.backgroundColor=&quot;orange&quot;, tabId});  };});
</code></pre><h2 id="unload-background-scripts" tabindex="-1"><a href="https://developer.chrome.com/docs/extensions/mv3/service_workers/#unloading" target="_blank" rel="noreferrer">#</a> Unload background scripts <a class="header-anchor" href="#unload-background-scripts" aria-hidden="true">#</a></h2><p>Unlike <a href="https://developer.chrome.com/docs/extensions/mv2/background_pages/" target="_blank" rel="noreferrer">event pages in Manifest V2</a>, extension service workers do not receive a <code>runtime.onSuspend</code> event before they are stopped. This is because documents have <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event" target="_blank" rel="noreferrer"><code>unload</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event" target="_blank" rel="noreferrer"><code>beforeUnload</code></a> events, but web workers (and by extension service workers) do not have an equivalent event.</p><p>Updated on Tuesday, May 1, 2018 \u2022 <a href="https://github.com/GoogleChrome/developer.chrome.com/blob/main/site/en/docs/extensions/mv3/service_workers/index.md" target="_blank" rel="noreferrer">Improve article</a></p>`,35),i=[s];function a(c,l,d,h,u,p){return r(),t("div",null,i)}const g=e(n,[["render",a]]);export{v as __pageData,g as default};
